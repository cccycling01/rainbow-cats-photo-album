# 留言板/悄悄话功能规格说明书

## 1. 功能概述

### 1.1 功能名称
**留言板** - 情侣互发消息/悄悄话

### 1.2 功能描述
允许情侣双方互相发送消息，支持普通留言和悄悄话（阅读后消失）两种模式。

### 1.3 优先级
P1 (高优先级)

---

## 2. 验收标准

### 2.1 核心功能
- [ ] 可以发送文字消息
- [ ] 消息按时间倒序显示
- [ ] 区分自己发送的消息和对方发送的消息
- [ ] 支持悄悄话模式（阅读后自动消失）
- [ ] 未读消息计数显示

### 2.2 悄悄话模式
- [ ] 发送时可选择"悄悄话"模式
- [ ] 悄悄话默认折叠显示
- [ ] 点击展开阅读
- [ ] 阅读后自动消失（仅发送者能看到）
- [ ] 双方都可发送悄悄话

### 2.3 交互体验
- [ ] 发送成功有动画反馈
- [ ] 新消息有提示动画
- [ ] 键盘弹出不影响布局

---

## 3. 页面结构

### 3.1 页面
| 页面 | 路径 | 描述 |
|------|------|------|
| 留言板 | `/pages/MessageBoard/index` | 消息列表 + 发送框 |

### 3.2 页面流程
```
MainPage (主页)
    ↓ 点击"留言板"
MessageBoard (留言板)
    ├── 浏览消息列表
    ├── 发送普通消息
    └── 发送悄悄话
```

---

## 4. 数据库设计

### 4.1 消息集合: `MessageList`

```json
{
  "_id": "auto-generated",
  "_openid": "sender-openid",
  "sender": "卡比",           // 发送者名字
  "senderId": "A",            // A 或 B
  "receiver": "瓦豆",          // 接收者名字
  "receiverId": "B",           // A 或 B
  "content": "消息内容",
  "type": "normal",           // "normal" 普通消息 | "whisper" 悄悄话
  "isRead": false,            // 是否已读（悄悄话用）
  "createTime": "2026-02-27T12:00:00.000Z"
}
```

---

## 5. UI/UX 设计

### 5.1 布局
- 顶部显示"我们的留言板"标题
- 消息列表区域（可滚动）
- 底部固定输入框 + 发送按钮
- 发送框旁边可切换"悄悄话"模式

### 5.2 消息气泡样式
- 自己发送的消息：右对齐，主题色背景
- 对方发送的消息：左对齐，灰色背景
- 悄悄话：特殊样式，有折叠/展开效果

### 5.3 动画
- 新消息滑入动画
- 悄悄话阅读后消失动画

---

## 6. 涉及文件

```
miniprogram/pages/MessageBoard/
├── index.js
├── index.json
├── index.wxml
└── index.wxss
```

---

## 7. 测试用例

- [ ] 发送普通消息成功
- [ ] 发送悄悄话成功
- [ ] 悄悄话阅读后消失
- [ ] 消息列表正确显示
- [ ] 未读计数正确

---

**创建日期:** 2026-02-27
**版本:** 1.0
**状态:** 待开发
